# Kubernetes
kubernetes是目前云原生技术栈的核心技术，它是由Google将自己10余年的容器编排系统brog通过go语言实现并开源出来的。云原生技术栈就是以kubernetes为核心来组织的。
## kubernetes架构
kubernetes集群的工作节点（服务器）主要分为两种角色类型，分为master节点与node节点，master节点主要的工作是维护整个集群的状态、各节点之间的管理，node节点也就是工作节点主要是管理运行应用容器的。在master节点上主要运行的组件包括（kube-apiserver、kube-scheduler、kube-controller-manager），node节点运行的组件包括（kubelet、kube-proxy），额外还需要一个etcd集群，etcd也可以安装在master节点上。
![kubernetes架构图](https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg)
上面的kubernetes的架构表示的是一个单master节点三个node节点的集群，集群之间的交互都是通过master上的api-server组件进行交互。
所有的组件都不会直接操作etcd。
### kube-apiserver
kubernetes通过apiserver暴露所有的api接口，因此apiserver相当人的大脑用于接收、发送指令，一切对集群状态以及所有资源的增删改查的操作都需要通过apiserver然后apiserver在对操作完成认证、权限检查等准入控制后，再由apiserver将合法的操作写入到ectd中去。因此在生产环境中需要部署多个master节点的集群，将api-server变成一个高可用的集群，api-server在部署的时候会暴露两个端口一个是http的用于集群内部组件的交互，一个是https的用于集群外部客户端的交互比如kubectl
### kube-scheduler
kube-scheduler组件的主要功能是根据调度算法，将待运行Pod调度到一个最适合的node（节点）上去执行。它监听api-server上的创建Pod的事件，然后将待分配节点列表默认是选择一个资源占用较少的节点去部署。当然也可以自定义调度规则调度Pod到合适的节点运行，一般可以设置亲缘行于反亲缘来调度Pod。
### kube-controller-manager
kube-controller-manager组件的主要作用就是管理用户在k8s中创建所有资源，通过不同的控制器去管理不同的资源，控制器的主要目的将是
k8s集群中对应资源的

<!--stackedit_data:
eyJoaXN0b3J5IjpbMTQxNTA2Nzk2NiwtMzU0NTY2MzY1LC03OD
g3Njg1NzAsLTgyMTA5ODE5MywtMjY3Nzk0Mzg5LC0xNTc4MDM3
NzM3LDI3MTE2NTQ4NCw2MDAwMzYzNzEsMTMyNzQwMzAxOCwtMT
Y2OTg4MTM5OCwxMDA0OTU5ODM0LC0xNTE4Mzk4OTAyLC04MzU1
MDE0NDIsOTg2MTc2MjczXX0=
-->